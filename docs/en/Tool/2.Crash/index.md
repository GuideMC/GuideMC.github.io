# 崩溃报告分析

本章旨在帮助您分析并解决在游玩 Minecraft 过程中遇到的游戏崩溃、无响应、联机失败或启动器错误等问题。  
当您遭遇异常时，请首先参考以下流程进行排查，详细信息请参考本节其它内容。

## 0. 流程概览

以下是解决 Minecraft 各种问题的流程总览，分析崩溃报告时应参考此流程进行处理：

```text
异常发生
  ↓ 选择问题类型
  ├─ 1. 游戏崩溃
  │   ├─ 启动器捕获了问题 → 导出游戏崩溃信息
  │   └─ 启动器未捕获问题 → (游戏内崩溃提示 / 禁用阻碍崩溃的模组如 Not Enough Crashes、LoliASM 等重新崩一次) → 手动收集崩溃信息
  │   ↓ 查看日志并判断错误类型
  │   ├─ 模组与前置版本不匹配 → ${modid1} 和 ${modid2} 版本不匹配
  │   ├─ 模组报错
  │   │   ├─ (可以确认冲突集) → 导出中间 class 判断冲突集 → ${modid1} 和 ${modid2} 冲突
  │   │   ├─ (只可见注入失败的模组) → 出现新的崩溃，请重新提问
  │   │   └─ (默认) → ${modid} 模组报错
  │   ├─ Java 版本错误 → 更换正确的 Java
  │   ├─ Java 虚拟机崩溃 → 虚拟内存不足
  │   ├─ 并发修改异常
  │   │   ├─ 查看源码并寻找被并发修改的容器 → 使用 CMESuckMyDuck 工具监控该容器
  │   │   └─ (诊断结果通常指向) → 虚拟内存不足
  │   └─ 疑似外部报错 → 查看系统的事件查看器
  │       ├─ Java 应用挂起 → 线程丢失 → 出现新的崩溃，请重新提问
  │       ├─ Java 应用错误 → 查看错误模块和线程调用栈
  │       │   ├─ 硬件驱动模块报错 → 升级驱动
  │       │   ├─ 崩溃发生在C2编译器线程? --> 是 → 暂停禁用 C2 编译器
  │       │   └─ 否 → 是否超频? 是否硬件有缩缸风险? --> 是 → 关闭超频软件或降压后重启
  │       │                                             └─ 否 → 用户自行排查设备硬件问题
  │       └─ 疑似硬件或Java虚拟机问题 (此路径通常引向上述硬件或C2编译器排查)
  ├─ 2. 游戏未响应
  │   ↓ 使用 jstack 工具或在 HMCL 启动器的“查看日志”窗口中导出、查看运行栈并判断线程状态
  │   ├─ 线程丢失 (应用挂起) → 出现新的崩溃，请重新提问
  │   ├─ 多个模块形成死锁 → ${modid} 卡住了
  │   ├─ 某模组占用主线程超 10 秒 → ${modid} 卡住了
  │   ├─ Java 问题 → 更换正确的 Java
  │   └─ 连接超时 → 使用代理或更换网络环境
  ├─ 3. 启动器内报错 (下载/更新/登录账号等)
  │   ↓ 导出、查看启动器日志并判断错误类型
  │   ├─ 账号问题 (已锁定/已冻结) → 用户自行申诉并重新登录
  │   ├─ 连接超时 → 更新或更换启动器 / 使用代理或更换网络环境
  │   ├─ 启动器本身问题 → 更新或更换启动器
  │   └─ Java 问题 → 更换正确的 Java
  └─ 4. 联机失败
      ↓ 服务端主机对客户端是否可见?
      ├─ 不可见 → 获取服务端 debug.log 获得完整信息 → 使用 CMESuckMyDuck 工具在服务端监控该 packet 的构造函数
      └─ 可见 → (如果没 debug.log 日志则需要修改 log4j2 配置并重新复现一下) → 手动收集 debug.log、disconnect 等日志
          ↓ 查看日志并判断错误类型
          ├─ IP 地址或端口号错误 → 重新输入正确的 IP 与端口
          ├─ 正版验证失败 → 重启客户端并重正版验证登录
          ├─ EncoderException 且客户端无信息 → 检查联机工具或服务是否正常工作
          ├─ DecoderException 无法解析的原版包 → 检查联机工具或服务是否正常工作
          └─ SSL 证书问题 → 修改环境变量，添加信任库
```

## 1. 游戏崩溃或意外退出 (Game Crash / Unexpected Exit)

这是最常见也最复杂的一类问题。当游戏在启动或运行过程中突然关闭时，请遵循以下步骤。

### 1.1 收集关键崩溃信息

首先，我们需要获取记录了错误原因的日志文件。

#### 1.1.1 启动器或游戏内模组已捕获问题

**现象：** 游戏崩溃后，启动器或游戏界面弹出一个提示窗口（通常由 `Not Enough Crashes` 或 `LoliASM` 等模组提供）。  
**操作：** 点击提示窗口上的“导出”或“查看”按钮，直接获取完整的**崩溃报告 (Crash Report)**。  
**专家建议：** 为获取最原始的崩溃报告，有时可暂时禁用这类崩溃处理模组（如 `Not Enough Crashes`、`LoliASM` 等），让游戏再次崩溃以生成更底层的错误日志。

#### 1.1.2 游戏直接消失，启动器无响应

**现象：** 游戏窗口凭空消失，启动器没有任何提示或反应。  
**操作：** 手动进入游戏文件夹，找到并收集以下文件：  
最新生成的崩溃报告 `.txt` 文件：通常位于 `.minecraft/crash-reports/` 目录下。  
最新的日志文件：即 `.minecraft/logs/` 目录下的 `latest.log`。

### 1.2 分析日志，定位崩溃原因

打开您获取的崩溃报告或 `latest.log` 文件，根据其中的错误信息，可将问题归为以下几类：

#### 1.2.1 模组冲突 (Mod Conflict)

**日志特征：** 报告中包含 `MixinConflictException` 或类似关键词，通常会明确列出两个或多个冲突的模组 ID（如 `${modid1}` 和 `${modid2}`）。若日志仅显示部分注入失败的模组，可能需要更深入的分析。  
**深入分析 (需专家协助)：** 提供崩溃报告后，专家可能会导出中间 `class` 文件来判断具体的冲突集，或查看源码以寻找被并发修改的容器。有时可能需要使用 `CMESuckMyDuck` 等工具监控特定容器。  
**解决方案：**

1. 根据日志提示，尝试禁用其中一个冲突的模组。
2. 查找这些模组是否有新的兼容版本或官方/社区提供的兼容补丁。
3. **特殊情况：** 若遇到罕见的 `Feature Order Cycle`（加载顺序循环冲突），可尝试使用 `Cyanide` 模组来输出更详细的诊断信息。

#### 1.2.2 模组自身错误 (Mod Error)

**日志特征：** 错误追踪（Stack Trace）的顶端明确指向了某一个特定模组（`${modid}`）的内部代码。  
**解决方案：**

1. 禁用或删除引发错误的 `${modid}` 模组。
2. 前往该模组发布页，检查是否有修复该问题的新版本并尝试更新。

**专家建议：** 一个典型案例是，若 `Sodium` 模组因与 `Fabric API` 的兼容性问题报错，安装 `Indium` 模组通常可以解决。

#### 1.2.3 模组版本不匹配 (Mod Version Mismatch)

**日志特征：** 日志中明确提示模组之间或模组与游戏本体（如 Forge/Fabric 加载器）存在版本不兼容。例如，`${modid1}` 和 `${modid2}` 版本不匹配。  
**解决方案：** 仔细核对并更换相关模组的版本，确保它们相互兼容，并与您的游戏版本及模组加载器版本匹配。

#### 1.2.4 Java 版本错误 (Java Version Error)

**日志特征：** 报告中出现 `UnsupportedClassVersionError`，或直接提示当前 Java 版本过低/过高。  
**解决方案：** **更换正确的 Java 版本**。根据您的 Minecraft 版本和整合包要求，安装并配置推荐的 Java 版本（如 Java 8, 11, 17 等）。

#### 1.2.5 Java 虚拟机 (JVM) 崩溃

**日志特征：** 报告中出现底层错误，如 `OutOfMemoryError` (内存不足) 或 `ConcurrentModificationException` (并发修改异常)。  
**解决方案：**  
**虚拟内存不足：** 最常见的原因是分配给游戏的内存不足。请在启动器设置中调高分配的内存（RAM），例如从 2GB 增加到 4GB 或更高。  
**并发修改异常 (需专家协助)：** 对于更复杂的底层并发问题，开发者可能需要查看源码并寻找被并发修改的容器，甚至使用 `CMESuckMyDuck` 等高级工具进行监控排查。

#### 1.2.6 疑似外部或硬件问题

**日志特征：** 游戏日志非常“干净”，没有记录任何明显的错误信息，但游戏依然崩溃。  
**深入排查：**

1. 打开操作系统的**事件查看器 (Event Viewer)**。
2. 在事件查看器中，查找与 `javaw.exe` 相关的错误日志并分析其内容：
   - **应用挂起 (Application Hang):** 说明游戏进入无响应状态。请参考下文“2. 游戏未响应或卡死”部分的处理方法。
   - **应用错误 (Application Error):** 查看错误的详细信息，特别是错误模块和调用栈：
     - **错误模块为显卡驱动** (如 `nvwgf2umx.dll`, `amdxx.dll`) → **解决方案：** 更新或重新安装您的显卡驱动。
     - **错误发生在 C2 编译器线程** → **解决方案：** 尝试在启动器中添加 JVM 参数 `-XX:DisableC2Compiler` 来暂时禁用 C2 编译器。
     - **无明显规律，但您对设备进行了超频** → **解决方案：** 关闭所有超频软件，或将 CPU/GPU/内存频率和电压恢复至默认值后重启。若存在“缩缸”风险，可能需要专业的硬件检测。
     - **以上均不符合** → **解决方案：** 问题可能源于硬件故障，用户需自行排查硬件问题（如内存条、硬盘、电源等）。

## 2. 游戏未响应或卡死 (Game Freezes / Not Responding)

当游戏画面卡住，程序显示“未响应”但并未立即关闭时，请按以下流程操作。

### 2.1 获取线程堆栈信息 (Thread Dump)

**操作：** 使用专业工具 `jstack`，或通过部分启动器（如 HMCL）提供的“查看日志”或“游戏进程管理”功能，**导出游戏卡死瞬间的线程堆栈 (Thread Dump)**。这份文件记录了所有线程当时正在执行的任务。

### 2.2 分析堆栈，判断卡死原因

**操作：** 查看导出的运行栈文件，并判断线程状态。

#### 2.2.1 死锁 (Deadlock)

**堆栈特征：** 可以看到多个模组的线程在相互等待对方释放资源，形成了一个无法解开的闭环。  
**解决方案：** 找到导致死锁的核心模组 `${modid}`，它很可能是问题的根源。尝试禁用或更新该模组。

#### 2.2.2 主线程被长时间占用 (Main Thread Hogged)

**堆栈特征：** 游戏的主线程 (`Main Thread`) 被某个模组的单一操作卡住，持续时间超过10秒。  
**解决方案：** 定位到长时间占用主线程的模组 `${modid}`，该模组是导致卡顿的根源。尝试禁用或更新它。

#### 2.2.3 连接超时 (Connection Timeout)

**堆栈特征：** 线程卡在与网络请求相关的操作上。  
**解决方案：** **优化您的网络环境**。尝试使用网络代理、加速器，或切换网络连接（如从 Wi-Fi 换为有线网络）。

## 3. 联机失败 (Multiplayer Failure)

当您无法连接到服务器或在联机过程中断开连接时，请按以下流程排查。

### 3.1 检查服务器可见性

**操作：** 首先确认服务端主机对客户端是否可见。

#### 3.1.1 服务端不可见 (Not Visible)

**操作 (需服务器管理员协助)：** 收集服务器端的 `debug.log` 文件以获取完整信息。  
**深入分析 (需专家协助)：** 专家可能会使用 `CMESuckMyDuck` 工具在服务器端监控特定数据包 (`packet`) 的构造函数，以诊断网络通信中的深层问题。

#### 3.1.2 服务端可见 (Visible)

**操作：** 查看客户端日志并判断错误类型。  
**诊断层备注：** 模组报错、缺少前置或版本不匹配、模组冲突、并发修改等问题同样可能引起连接中断，确认方法与崩溃诊断相同，不过问题发生在I/O线程而非主线程。

### 3.2 客户端日志分析与解决方案

根据客户端日志中的错误信息，进行相应处理：  
**IP 地址或端口号错误：** 重新输入正确的服务器 IP 地址与端口号。  
**正版验证失败：** 重启客户端并重新进行正版验证登录。  
**EncoderException (且客户端无详细信息)：** 检查联机工具或服务（如 VPN、加速器、防火墙）是否正常工作或存在干扰。  
**DecoderException (无法解析的原版包)：** 检查联机工具或服务是否正常工作或存在干扰，确保数据包未被损坏或篡改。  
**SSL 证书问题：** 修改系统环境变量，添加必要的信任库或更新证书。  
**账号问题 (已锁定/已冻结)：** 用户需自行向 Mojang/Microsoft 官方申诉，并尝试重新登录。  
**连接超时：** 优化网络环境，尝试使用代理或更换网络连接。

## 4. 启动器问题 (Launcher Issues)

当启动器在下载、更新、登录账号等操作时报错，请按以下流程排查。

### 4.1 收集启动器日志

**操作：** 导出启动器自身的日志文件。

### 4.2 分析日志，定位问题

根据启动器日志中的错误信息，进行相应处理：  
**账号问题 (已锁定/已冻结)：** 用户需自行向 Mojang/Microsoft 官方申诉，并尝试重新登录。  
**连接超时：** 优化网络环境，尝试使用代理或更换网络环境。  
**启动器本身问题：** 尝试更新启动器到最新版本，或更换为其他可靠的 Minecraft 启动器。

## 最终诊断结果与重要提示

**重要提示：** Minecraft 用户协议明确规定，包括但不限于公开服务器、局域网等联机功能，只授权拥有正版 Minecraft 的用户使用。  
如果您没有正版账号，请购买正版或返回体验单人游戏。如果您拥有正版账号但不希望使用官方服务器验证登录，请关闭服务器的在线模式。  
**当以上步骤无法解决问题时：** 如果在执行上述排查后，仍然出现新的崩溃或其他未解决的问题，请重新提问并提供最新的崩溃报告或日志文件，以便我们进行更深入的分析。
